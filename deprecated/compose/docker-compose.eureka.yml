version: "3.9"

services:
  eureka-server:
    image: springcloud/eureka:latest
    container_name: eureka-server
    hostname: eureka-server
    restart: unless-stopped
    ports:
      - "8761:8761"
    environment:
      SPRING_APPLICATION_NAME: discovery-server
      SERVER_PORT: 8761
      EUREKA_INSTANCE_HOSTNAME: eureka-server
      EUREKA_INSTANCE_PREFER_IP_ADDRESS: "true"
      EUREKA_CLIENT_REGISTER_WITH_EUREKA: "false"
      EUREKA_CLIENT_FETCH_REGISTRY: "false"
      EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: http://eureka-server:8761/eureka/
      EUREKA_SERVER_ENABLE_SELF_PRESERVATION: "true"
      EUREKA_SERVER_EVICTION_INTERVAL_TIMER_IN_MS: 60000
      EUREKA_SERVER_RENEWAL_THRESHOLD_UPDATE_INTERVAL_MS: 900000
      LOGGING_LEVEL_COM_NETFLIX_EUREKA: INFO
      LOGGING_LEVEL_COM_NETFLIX_DISCOVERY: INFO
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8761/actuator/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - microservices
    volumes:
      - eureka_data:/var/lib/eureka

volumes:
  eureka_data:

networks:
  microservices:
    external: true
